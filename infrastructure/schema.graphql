type User {
  userId: ID!
  email: String!
  name: String!
  role: UserRole!
  profileImage: String
  tier: UserTier!
  phone: String
  bio: String
  genres: [String!]
  createdAt: AWSTimestamp!
  updatedAt: AWSTimestamp!
  stats: UserStats!
  preferences: UserPreferences!
}

type UserStats {
  totalRequests: Int!
  successfulRequests: Int!
  eventsAttended: Int!
  genresExplored: [String!]!
}

type UserPreferences {
  notificationsEnabled: Boolean!
  hapticFeedback: Boolean!
  reducedMotion: Boolean!
}

enum UserRole {
  PERFORMER
  AUDIENCE
}

enum UserTier {
  BRONZE
  SILVER
  GOLD
  PLATINUM
}

type Event {
  eventId: ID!
  venueName: String
  venueLocation: VenueLocation
  startTime: AWSTimestamp
  endTime: AWSTimestamp
  status: EventStatus!
  theme: String
  createdBy: ID
  createdAt: AWSTimestamp!
  totalRevenue: Float!
  totalRequests: Int!
  djSets: [DJSet!]!
}

type DJSet {
  setId: ID!
  eventId: ID!
  performerId: ID!
  performer: User
  setStartTime: AWSTimestamp!
  setEndTime: AWSTimestamp!
  status: SetStatus!
  settings: EventSettings!
  isAcceptingRequests: Boolean!
  qrCode: String
  revenue: Float!
  requestCount: Int!
  createdAt: AWSTimestamp!
}

type VenueLocation {
  address: String!
  city: String!
  province: String!
  coordinates: Coordinates
}

type Coordinates {
  lat: Float!
  lng: Float!
}

type EventSettings {
  basePrice: Float!
  requestCapPerHour: Int!
  spotlightSlotsPerBlock: Int!
  allowDedications: Boolean!
  allowGroupRequests: Boolean!
}

enum EventStatus {
  SCHEDULED
  ACTIVE
  COMPLETED
  CANCELLED
}

enum SetStatus {
  SCHEDULED
  ACTIVE
  COMPLETED
  CANCELLED
}

type Request {
  requestId: ID!
  eventId: ID!
  setId: ID!
  performerId: ID!
  userId: ID!
  user: User
  userName: String
  userTier: UserTier
  songTitle: String!
  artistName: String!
  genre: String
  albumArt: String
  duration: String
  status: RequestStatus!
  requestType: RequestType!
  price: Float!
  queuePosition: Int
  dedication: String
  shoutout: String
  submittedAt: AWSTimestamp!
  acceptedAt: AWSTimestamp
  playedAt: AWSTimestamp
  vetoedAt: AWSTimestamp
  vetoReason: String
  vetoedBy: ID
  transactionId: String!
  refundTransactionId: String
  groupRequestId: String
  upvotes: Int!
}

enum RequestStatus {
  PENDING
  ACCEPTED
  APPROVED
  PLAYING
  COMPLETED
  VETOED
  VETOED_REFUND_PENDING
}

enum RequestType {
  STANDARD
  SPOTLIGHT
  GROUP
}

type Queue {
  setId: ID!
  eventId: ID!
  performerId: ID!
  orderedRequests: [Request!]!
  lastUpdated: AWSTimestamp!
  currentlyPlaying: Request
}

type Transaction {
  transactionId: ID!
  userId: ID!
  eventId: ID!
  requestId: ID!
  amount: Float!
  type: TransactionType!
  status: TransactionStatus!
  paymentProvider: PaymentProvider!
  providerTransactionId: String!
  createdAt: AWSTimestamp!
  completedAt: AWSTimestamp
}

enum TransactionType {
  CHARGE
  REFUND
}

enum TransactionStatus {
  PENDING
  COMPLETED
  FAILED
}

enum PaymentProvider {
  YOCO
  PAYFAST
  OZOW
}

type Achievement {
  userId: ID!
  badges: [Badge!]!
  score: Int!
  milestones: Milestones!
}

type Badge {
  badgeId: ID!
  name: String!
  tier: UserTier!
  unlockedAt: AWSTimestamp!
}

type Milestones {
  firstRequest: AWSTimestamp
  firstGroupRequest: AWSTimestamp
  first10Requests: AWSTimestamp
  first50Requests: AWSTimestamp
}

type GroupRequest {
  groupRequestId: ID!
  eventId: ID!
  initiatorUserId: ID!
  initiator: User
  songTitle: String!
  artistName: String!
  targetAmount: Float!
  currentAmount: Float!
  contributors: [Contributor!]!
  status: GroupRequestStatus!
  expiresAt: AWSTimestamp!
  createdAt: AWSTimestamp!
  requestId: String
}

type Contributor {
  userId: ID!
  user: User
  amount: Float!
  contributedAt: AWSTimestamp!
}

enum GroupRequestStatus {
  FUNDING
  FUNDED
  EXPIRED
  COMPLETED
}

type EventConnection {
  items: [Event!]!
  nextToken: String
}

type Track {
  trackId: ID!
  eventId: ID!
  performerId: ID!
  title: String!
  artist: String!
  genre: String
  albumArt: String
  duration: Int
  basePrice: Float!
  isEnabled: Boolean!
  createdAt: AWSTimestamp!
  updatedAt: AWSTimestamp!
}

type Query {
  getUser(userId: ID!): User
  getEvent(eventId: ID!): Event
  listActiveEvents(limit: Int, nextToken: String): EventConnection
  getDJSet(setId: ID!): DJSet
  listEventDJSets(eventId: ID!): [DJSet!]!
  listPerformerSets(performerId: ID!, limit: Int): [DJSet!]!
  getQueue(setId: ID!): Queue
  getEventTracklist(eventId: ID!): [Track!]!
  getRequest(requestId: ID!): Request
  getUserRequests(userId: ID!, limit: Int): [Request!]!
  getEventRequests(eventId: ID!, status: RequestStatus): [Request!]!
  getSetRequests(setId: ID!, status: RequestStatus): [Request!]!
  getTransaction(transactionId: ID!): Transaction
  getUserTransactions(userId: ID!, limit: Int): [Transaction!]!
  getAchievements(userId: ID!): Achievement
  getGroupRequest(groupRequestId: ID!): GroupRequest
  listActiveGroupRequests(eventId: ID!): [GroupRequest!]!
}

input VenueLocationInput {
  address: String
  city: String
  province: String
}

input CreateEventInput {
  venueName: String!
  venueLocation: VenueLocationInput
  startTime: AWSTimestamp!
  endTime: AWSTimestamp!
  status: EventStatus
  theme: String
}

input CreateDJSetInput {
  eventId: ID!
  setStartTime: AWSTimestamp!
  setEndTime: AWSTimestamp!
  basePrice: Float
  requestCapPerHour: Int
  spotlightSlotsPerBlock: Int
  allowDedications: Boolean
  allowGroupRequests: Boolean
}

input CreateRequestInput {
  eventId: ID!
  setId: ID!
  songTitle: String!
  artistName: String!
  genre: String
  requestType: RequestType!
  dedication: String
  shoutout: String
}

input GroupRequestInput {
  eventId: ID!
  songTitle: String!
  artistName: String!
  targetAmount: Float!
}

input UpdateDJSetSettingsInput {
  requestCapPerHour: Int
  basePrice: Float
  isSoldOut: Boolean
  allowDedications: Boolean
  allowGroupRequests: Boolean
  spotlightSlotsPerBlock: Int
}

input UpdateDJProfileInput {
  name: String
  bio: String
  genres: [String!]
  photo: String
  basePrice: Float
}

type Mutation {
  createUser(email: String!, name: String!, role: UserRole!): User
  updateUser(userId: ID!, name: String, profileImage: String, phone: String): User
  updateDJProfile(userId: ID!, input: UpdateDJProfileInput!): User
  
  createEvent(input: CreateEventInput!): Event
  updateEventStatus(eventId: ID!, status: EventStatus!): Event
  
  createDJSet(input: CreateDJSetInput!): DJSet
  updateDJSetStatus(setId: ID!, status: SetStatus!): DJSet
  updateDJSetSettings(setId: ID!, input: UpdateDJSetSettingsInput!): DJSet
  toggleSetAvailability(setId: ID!, isAcceptingRequests: Boolean!): DJSet
  
  createRequest(input: CreateRequestInput!): Request
  acceptRequest(requestId: ID!, setId: ID!): Request
  updateRequestStatus(requestId: ID!, status: RequestStatus!): Request
  markRequestAsPlaying(requestId: ID!, setId: ID!): Request
  markRequestAsCompleted(requestId: ID!): Request
  vetoRequest(requestId: ID!, reason: String): Request
  
  reorderQueue(setId: ID!, orderedRequestIds: [ID!]!): Queue
  upvoteRequest(requestId: ID!): Request
  
  createGroupRequest(input: GroupRequestInput!): GroupRequest
  contributeToGroupRequest(groupRequestId: ID!, amount: Float!): GroupRequest
}

type Subscription {
  onQueueUpdate(eventId: ID!): Queue
    @aws_subscribe(mutations: ["reorderQueue"])
  
  onRequestStatusChange(requestId: ID!): Request
    @aws_subscribe(mutations: ["updateRequestStatus", "vetoRequest"])
  
  onNewRequest(eventId: ID!): Request
    @aws_subscribe(mutations: ["createRequest"])
  
  onEventUpdate(eventId: ID!): Event
    @aws_subscribe(mutations: ["updateEventStatus"])
  
  onGroupRequestUpdate(groupRequestId: ID!): GroupRequest
    @aws_subscribe(mutations: ["contributeToGroupRequest"])
}

schema {
  query: Query
  mutation: Mutation
  subscription: Subscription
}
